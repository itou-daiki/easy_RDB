<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>easyRDB</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .panel h3 {
            margin-bottom: 15px;
            color: #4a5568;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .sql-editor {
            width: 100%;
            height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            resize: vertical;
            background: #f8fafc;
        }

        .sql-editor:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .result-area {
            margin-top: 20px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background: #4a5568;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        tr:hover {
            background: #f7fafc;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f56565;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #48bb78;
        }

        .schema-view {
            font-size: 14px;
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .schema-table {
            margin-bottom: 20px;
        }

        .schema-table h4 {
            color: #2d3748;
            margin-bottom: 10px;
            padding: 8px;
            background: #edf2f7;
            border-radius: 4px;
        }

        .exercise-panel {
            grid-column: 1 / -1;
        }

        .exercise-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .exercise-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .exercise-card h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .exercise-card p {
            color: #4a5568;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .button-group {
                justify-content: center;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ƒï¸ RDBå®Ÿè·µã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>GitHub Pagesã§å‹•ä½œã™ã‚‹ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å­¦ç¿’ç’°å¢ƒ</p>
        </div>

        <div class="main-content">
            <div class="panel">
                <h3>ğŸ“ SQLã‚¯ã‚¨ãƒªã‚¨ãƒ‡ã‚£ã‚¿</h3>
                <textarea id="sqlEditor" class="sql-editor" placeholder="SELECT * FROM users;&#10;&#10;-- ã“ã“ã«SQLã‚¯ã‚¨ãƒªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„&#10;-- ä¾‹: SELECT name, email FROM users WHERE age > 25;"></textarea>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="executeQuery()">ğŸš€ å®Ÿè¡Œ</button>
                    <button class="btn btn-secondary" onclick="clearEditor()">ğŸ§¹ ã‚¯ãƒªã‚¢</button>
                    <button class="btn btn-danger" onclick="resetDatabase()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ</button>
                </div>

                <div class="result-area">
                    <div id="queryResult"></div>
                </div>
            </div>

            <div class="panel">
                <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ</h3>
                <div class="schema-view">
                    <div class="schema-table">
                        <h4>users ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
                        <p><strong>id:</strong> INTEGER (PRIMARY KEY)</p>
                        <p><strong>name:</strong> TEXT</p>
                        <p><strong>email:</strong> TEXT</p>
                        <p><strong>age:</strong> INTEGER</p>
                        <p><strong>department:</strong> TEXT</p>
                    </div>

                    <div class="schema-table">
                        <h4>orders ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
                        <p><strong>id:</strong> INTEGER (PRIMARY KEY)</p>
                        <p><strong>user_id:</strong> INTEGER (FOREIGN KEY)</p>
                        <p><strong>product_name:</strong> TEXT</p>
                        <p><strong>price:</strong> INTEGER</p>
                        <p><strong>order_date:</strong> TEXT</p>
                    </div>

                    <div class="schema-table">
                        <h4>departments ãƒ†ãƒ¼ãƒ–ãƒ«</h4>
                        <p><strong>id:</strong> INTEGER (PRIMARY KEY)</p>
                        <p><strong>name:</strong> TEXT</p>
                        <p><strong>manager:</strong> TEXT</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel exercise-panel">
            <h3>ğŸ¯ ç·´ç¿’å•é¡Œ</h3>
            <div class="exercise-list">
                <div class="exercise-card">
                    <h4>åŸºæœ¬ã®SELECT</h4>
                    <p>å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
                <div class="exercise-card">
                    <h4>æ¡ä»¶æ¤œç´¢</h4>
                    <p>å¹´é½¢ãŒ30æ­³ä»¥ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
                <div class="exercise-card">
                    <h4>JOINæ“ä½œ</h4>
                    <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãã®æ³¨æ–‡å±¥æ­´ã‚’çµåˆã—ã¦è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚</p>
                </div>
                <div class="exercise-card">
                    <h4>é›†ç´„é–¢æ•°</h4>
                    <p>éƒ¨ç½²ã”ã¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ãã ã•ã„ã€‚</p>
                </div>
                <div class="exercise-card">
                    <h4>ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥</h4>
                    <p>æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’usersãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
                <div class="exercise-card">
                    <h4>ãƒ‡ãƒ¼ã‚¿æ›´æ–°</h4>
                    <p>ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        let database = {
            users: [
                { id: 1, name: 'ç”°ä¸­å¤ªéƒ', email: 'tanaka@example.com', age: 28, department: 'å–¶æ¥­éƒ¨' },
                { id: 2, name: 'ä½è—¤èŠ±å­', email: 'sato@example.com', age: 32, department: 'é–‹ç™ºéƒ¨' },
                { id: 3, name: 'éˆ´æœ¨ä¸€éƒ', email: 'suzuki@example.com', age: 26, department: 'å–¶æ¥­éƒ¨' },
                { id: 4, name: 'é«˜æ©‹ç¾å’²', email: 'takahashi@example.com', age: 35, department: 'äººäº‹éƒ¨' },
                { id: 5, name: 'å±±ç”°å¥å¤ª', email: 'yamada@example.com', age: 29, department: 'é–‹ç™ºéƒ¨' }
            ],
            orders: [
                { id: 1, user_id: 1, product_name: 'ãƒãƒ¼ãƒˆPC', price: 80000, order_date: '2024-01-15' },
                { id: 2, user_id: 2, product_name: 'ãƒã‚¦ã‚¹', price: 3000, order_date: '2024-01-20' },
                { id: 3, user_id: 1, product_name: 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰', price: 8000, order_date: '2024-02-01' },
                { id: 4, user_id: 3, product_name: 'ãƒ¢ãƒ‹ã‚¿ãƒ¼', price: 25000, order_date: '2024-02-10' },
                { id: 5, user_id: 4, product_name: 'ãƒ—ãƒªãƒ³ã‚¿ãƒ¼', price: 15000, order_date: '2024-02-15' }
            ],
            departments: [
                { id: 1, name: 'å–¶æ¥­éƒ¨', manager: 'å–¶æ¥­éƒ¨é•·' },
                { id: 2, name: 'é–‹ç™ºéƒ¨', manager: 'æŠ€è¡“éƒ¨é•·' },
                { id: 3, name: 'äººäº‹éƒ¨', manager: 'äººäº‹éƒ¨é•·' }
            ]
        };

        // åˆæœŸãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
        const initialData = JSON.parse(JSON.stringify(database));

        function resetDatabase() {
            database = JSON.parse(JSON.stringify(initialData));
            showResult('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚', 'success');
        }

        function executeQuery() {
            const query = document.getElementById('sqlEditor').value.trim();
            if (!query) {
                showResult('SQLã‚¯ã‚¨ãƒªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }

            try {
                const result = processSQL(query);
                displayResult(result);
            } catch (error) {
                showResult(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function processSQL(query) {
            const sql = query.toLowerCase().trim();
            
            if (sql.startsWith('select')) {
                return processSelect(query);
            } else if (sql.startsWith('insert')) {
                return processInsert(query);
            } else if (sql.startsWith('update')) {
                return processUpdate(query);
            } else if (sql.startsWith('delete')) {
                return processDelete(query);
            } else {
                throw new Error('ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„SQLæ–‡ã§ã™ã€‚SELECT, INSERT, UPDATE, DELETEã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚');
            }
        }

        function processSelect(query) {
            const sql = query.toLowerCase();
            
            // åŸºæœ¬çš„ãªSELECTæ–‡ã®è§£æ
            if (sql.includes('*') && sql.includes('from users') && !sql.includes('join')) {
                let result = [...database.users];
                if (sql.includes('where')) {
                    result = filterData(result, query);
                }
                return result;
            }
            
            if (sql.includes('*') && sql.includes('from orders')) {
                let result = [...database.orders];
                if (sql.includes('where')) {
                    result = filterData(result, query);
                }
                return result;
            }

            if (sql.includes('*') && sql.includes('from departments')) {
                return [...database.departments];
            }

            // JOINæ“ä½œ
            if (sql.includes('join')) {
                return processJoin(query);
            }

            // é›†ç´„é–¢æ•°
            if (sql.includes('count') || sql.includes('group by')) {
                return processAggregate(query);
            }

            // ç‰¹å®šã‚«ãƒ©ãƒ é¸æŠ
            if (sql.includes('from users')) {
                return processColumnSelect(query, 'users');
            }

            throw new Error('ã‚¯ã‚¨ãƒªã‚’è§£æã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚ˆã‚Šç°¡å˜ãªã‚¯ã‚¨ãƒªã‚’è©¦ã—ã¦ãã ã•ã„ã€‚');
        }

        function filterData(data, query) {
            const sql = query.toLowerCase();
            
            if (sql.includes('age >')) {
                const ageMatch = query.match(/age\s*>\s*(\d+)/i);
                if (ageMatch) {
                    const age = parseInt(ageMatch[1]);
                    return data.filter(item => item.age > age);
                }
            }

            if (sql.includes('age <')) {
                const ageMatch = query.match(/age\s*<\s*(\d+)/i);
                if (ageMatch) {
                    const age = parseInt(ageMatch[1]);
                    return data.filter(item => item.age < age);
                }
            }

            if (sql.includes('department =')) {
                const deptMatch = query.match(/department\s*=\s*['"]([^'"]+)['"]/i);
                if (deptMatch) {
                    const dept = deptMatch[1];
                    return data.filter(item => item.department === dept);
                }
            }

            return data;
        }

        function processJoin(query) {
            const sql = query.toLowerCase();
            
            if (sql.includes('users') && sql.includes('orders')) {
                const result = [];
                for (const user of database.users) {
                    for (const order of database.orders) {
                        if (order.user_id === user.id) {
                            result.push({
                                user_name: user.name,
                                user_email: user.email,
                                product_name: order.product_name,
                                price: order.price,
                                order_date: order.order_date
                            });
                        }
                    }
                }
                return result;
            }

            throw new Error('JOINã‚¯ã‚¨ãƒªã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }

        function processAggregate(query) {
            const sql = query.toLowerCase();
            
            if (sql.includes('count') && sql.includes('group by department')) {
                const result = {};
                for (const user of database.users) {
                    result[user.department] = (result[user.department] || 0) + 1;
                }
                
                return Object.entries(result).map(([department, count]) => ({
                    department,
                    count
                }));
            }

            throw new Error('é›†ç´„ã‚¯ã‚¨ãƒªã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }

        function processColumnSelect(query, table) {
            const sql = query.toLowerCase();
            const data = database[table];
            
            // name, email ã®é¸æŠ
            if (sql.includes('name') && sql.includes('email')) {
                return data.map(item => ({ name: item.name, email: item.email }));
            }

            return data;
        }

        function processInsert(query) {
            const sql = query.toLowerCase();
            
            if (sql.includes('insert into users')) {
                const valuesMatch = query.match(/values\s*\(([^)]+)\)/i);
                if (valuesMatch) {
                    const values = valuesMatch[1].split(',').map(v => v.trim().replace(/['"]/g, ''));
                    const newId = Math.max(...database.users.map(u => u.id)) + 1;
                    
                    const newUser = {
                        id: newId,
                        name: values[0],
                        email: values[1],
                        age: parseInt(values[2]) || 0,
                        department: values[3] || ''
                    };
                    
                    database.users.push(newUser);
                    return `ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ: ${newUser.name}`;
                }
            }

            throw new Error('INSERTæ–‡ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }

        function processUpdate(query) {
            const sql = query.toLowerCase();
            
            if (sql.includes('update users')) {
                const setMatch = query.match(/set\s+(\w+)\s*=\s*['"]([^'"]+)['"]/i);
                const whereMatch = query.match(/where\s+id\s*=\s*(\d+)/i);
                
                if (setMatch && whereMatch) {
                    const field = setMatch[1];
                    const value = setMatch[2];
                    const id = parseInt(whereMatch[1]);
                    
                    const user = database.users.find(u => u.id === id);
                    if (user) {
                        user[field] = value;
                        return `ãƒ¦ãƒ¼ã‚¶ãƒ¼ID ${id} ã® ${field} ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚`;
                    }
                }
            }

            throw new Error('UPDATEæ–‡ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }

        function processDelete(query) {
            const sql = query.toLowerCase();
            
            if (sql.includes('delete from users')) {
                const whereMatch = query.match(/where\s+id\s*=\s*(\d+)/i);
                
                if (whereMatch) {
                    const id = parseInt(whereMatch[1]);
                    const index = database.users.findIndex(u => u.id === id);
                    
                    if (index !== -1) {
                        const deletedUser = database.users.splice(index, 1)[0];
                        return `ãƒ¦ãƒ¼ã‚¶ãƒ¼ ${deletedUser.name} ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`;
                    }
                }
            }

            throw new Error('DELETEæ–‡ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }

        function displayResult(result) {
            if (typeof result === 'string') {
                showResult(result, 'success');
                return;
            }

            if (Array.isArray(result) && result.length === 0) {
                showResult('ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œã¯æˆåŠŸã—ã¾ã—ãŸãŒã€çµæœãŒ0ä»¶ã§ã—ãŸã€‚', 'success');
                return;
            }

            if (Array.isArray(result)) {
                const table = createTable(result);
                document.getElementById('queryResult').innerHTML = `
                    <div class="success">ã‚¯ã‚¨ãƒªãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚çµæœ: ${result.length}ä»¶</div>
                    <div class="table-container">${table}</div>
                `;
            } else {
                showResult(result, 'success');
            }
        }

        function createTable(data) {
            if (!data || data.length === 0) return '';

            const columns = Object.keys(data[0]);
            
            let html = '<table>';
            html += '<thead><tr>';
            columns.forEach(col => {
                html += `<th>${col}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.forEach(row => {
                html += '<tr>';
                columns.forEach(col => {
                    html += `<td>${row[col] || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            return html;
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('queryResult');
            resultDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }

        function clearEditor() {
            document.getElementById('sqlEditor').value = '';
            document.getElementById('queryResult').innerHTML = '';
        }

        // åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        showResult('SQLã‚¯ã‚¨ãƒªã‚’å…¥åŠ›ã—ã¦ã€Œå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚', 'success');
    </script>
</body>
</html>